---
title: 'Embedding End-User Authentication UI'
description: 'Anchor Browser provides an embeddable identity creation flow that allows your users to authenticate to third-party websites directly from your application. This guide explains how to integrate the identity creation UI into your product.'
icon: 'window'
---

## Prerequisites

Before integrating the embedded identity flow, ensure the following are configured:

1. **Create an Application** - Define the target website users will authenticate to via the Anchor Dashboard or API
2. **Configure Authentication Flows** - Set up the supported login methods.

## Overview

<Steps>
<Step title="Generate a Token">
Create a one-time token that authorizes the identity creation flow.

<CodeGroup>
```javascript Node.js
import Anchorbrowser from 'anchorbrowser';

const anchorClient = new Anchorbrowser();

// Generate a token for identity creation
const tokenResponse = await anchorClient.applications.identities.tokens.create('your-application-id', {
  callbackUrl: 'https://your-app.com/identity-callback',
});

console.log(tokenResponse.token);
// Use this token to redirect the user
````

```python Python
from anchorbrowser import Anchorbrowser

anchor_client = Anchorbrowser()

# Generate a token for identity creation
token_response = anchor_client.applications.identities.tokens.create(
    application_id="your-application-id",
    callback_url="https://your-app.com/identity-callback"
)

print(token_response.token)
# Use this token to redirect the user
````

```bash cURL
curl -X POST "https://api.anchorbrowser.io/v1/applications/{application_id}/identities/tokens" \
  -H "anchor-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "callbackUrl": "https://your-app.com/identity-callback"
  }'
```
</CodeGroup>

### Token Response

| Field       | Type   | Description                                   |
| ----------- | ------ | --------------------------------------------- |
| `token`     | string | The one-time token to use in the redirect URL |
| `expiresAt` | date   | When the token expires                        |
| `tokenHash` | string | Hash of the token for verification            |

<Warning>
  The `callbackUrl` must use HTTPS. Store the token securely and use it immediately - tokens are single-use and expire
  after 15 minutes.
</Warning>
</Step>

<Step title="Redirect User to Identity Creation">
Redirect the user to the Anchor identity creation page with the generated token:

```
https://app.anchorbrowser.io/identity/create?token={token}
```

<CodeGroup>
```javascript Frontend (React)
function CreateIdentityButton({ token }) {
  const handleClick = () => {
    window.location.href = `https://app.anchorbrowser.io/identity/create?token=${token}`;
  };

  return <button onClick={handleClick}>Connect Your Account</button>;
}
````

```javascript Frontend (Vanilla JS)
function redirectToIdentityCreation(token) {
  window.location.href = `https://app.anchorbrowser.io/identity/create?token=${token}`;
}
````
</CodeGroup>

The user will be guided through the authentication process for the target website configured in the application.
</Step>

<Step title="Handle the Callback">
After the user successfully creates an identity, Anchor redirects them to the `callbackUrl` with the identity ID:

```
https://your-app.com/identity-callback?identityId={identity_id}
```

<CodeGroup>
```javascript Express.js
app.get('/identity-callback', async (req, res) => {
  const { identityId } = req.query;

  if (!identityId) {
    return res.status(400).send('Missing identity ID');
  }

  // Store the mapping between the user and the Anchor identity
  await saveUserIdentityMapping(req.user.id, identityId);

  // Optionally, update the identity with an external user ID

  res.redirect('/dashboard?connected=true');
});
````

```python Flask
@app.route('/identity-callback')
def identity_callback():
    identity_id = request.args.get('identityId')

    if not identity_id:
        return 'Missing identity ID', 400

    # Store the mapping between the user and the Anchor identity
    save_user_identity_mapping(current_user.id, identity_id)

    # Optionally, update the identity with an external user ID

    return redirect('/dashboard?connected=true')
````
</CodeGroup>
</Step>

<Step title="Update Identity Metadata (Optional)">
Update the identity with additional metadata to maintain a mapping between users and their Anchor identities:

<CodeGroup>
```javascript Node.js
import Anchorbrowser from 'anchorbrowser';

const anchorClient = new Anchorbrowser();

// Update identity with external user ID
const updatedIdentity = await anchorClient.identities.update(identityId, {
  name: 'User Display Name',
  metadata: {
    externalUserId: 'your-user-id-123',
    plan: 'premium',
    connectedAt: new Date().toISOString(),
  },
});
````

```python Python
from anchorbrowser import Anchorbrowser

anchor_client = Anchorbrowser()

# Update identity with external user ID
updated_identity = anchor_client.identities.update(
    identity_id=identity_id,
    name="User Display Name",
    metadata={
        "externalUserId": "your-user-id-123",
        "plan": "premium",
        "connectedAt": datetime.now().isoformat()
    }
)
````

```bash cURL
curl -X PUT "https://api.anchorbrowser.io/v1/identities/{identity_id}" \
  -H "anchor-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "User Display Name",
    "metadata": {
      "externalUserId": "your-user-id-123",
      "plan": "premium"
    }
  }'
```
</CodeGroup>

### Update Request Body

| Field         | Type   | Description                                                   |
| ------------- | ------ | ------------------------------------------------------------- |
| `name`        | string | Optional display name for the identity                        |
| `metadata`    | object | Key-value pairs for custom data (e.g., external user ID)      |
| `credentials` | array  | Optional credential updates                                   |
</Step>

<Step title="Create Authenticated Sessions">
Once an identity ID is available, use it to create authenticated browser sessions:

<CodeGroup>
```javascript Node.js
import Anchorbrowser from 'anchorbrowser';

const anchorClient = new Anchorbrowser();

// Create a session with the user's identity
const session = await anchorClient.sessions.create({
  identities: [{ id: identityId }],
});

console.log('Session created:', session.id);
console.log('WebSocket URL:', session.ws_endpoint);
````

```python Python
from anchorbrowser import Anchorbrowser

anchor_client = Anchorbrowser()

# Create a session with the user's identity
session = anchor_client.sessions.create(
    identities=[{ "id": identity_id }]
)

print(f"Session created: {session.id}")
print(f"WebSocket URL: {session.ws_endpoint}")
````

```bash cURL
curl -X POST "https://api.anchorbrowser.io/v1/sessions" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "identities": [{ "id": "identity-id-here" }]
  }'
```
</CodeGroup>

The browser session will automatically be authenticated to the target website using the stored identity.
</Step>
</Steps>

## Complete Integration Example

Here's a complete example showing the full flow:

<CodeGroup>
```javascript Node.js (Express)
import express from 'express';
import Anchorbrowser from 'anchorbrowser';

const app = express();
const anchorClient = new Anchorbrowser();

const APPLICATION_ID = 'your-application-id';

// Step 1: Initiate identity creation
app.post('/api/connect-account', async (req, res) => {
  const userId = req.user.id;

  // Generate token with callback URL
  const tokenResponse = await anchorClient.applications.identities.tokens.create(APPLICATION_ID, {
    callbackUrl: `https://your-app.com/api/identity-callback`,
  });

  // Store token-to-user mapping for callback verification
  await storeTokenMapping(tokenResponse.tokenHash, userId);

  // Return redirect URL to frontend
  res.json({
    redirectUrl: `https://app.anchorbrowser.io/identity/create?token=${tokenResponse.token}`,
  });
});

// Step 2: Handle callback after identity creation
app.get('/api/identity-callback', async (req, res) => {
  const { identityId } = req.query;

  // Save identity mapping
  await saveIdentityMapping(req.user.id, identityId);

  // Update identity with external reference
  await anchorClient.identities.update(identityId, {
    metadata: { externalUserId: req.user.id },
  });

  res.redirect('/dashboard?connected=true');
});

// Step 3: Use identity in browser sessions
app.post('/api/run-automation', async (req, res) => {
  const identityId = await getUserIdentity(req.user.id);

  const session = await anchorClient.sessions.create({
    browser: {
      identities: [{ id: identityId }],
    },
  });

  // Run your automation with the authenticated session
  // ...

  res.json({ sessionId: session.id });
});
```
</CodeGroup>

## Best Practices

<CardGroup cols={2}>
  <Card title="Secure Token Handling" icon="lock">
    Generate tokens server-side and never expose your API key to the frontend. Tokens are single-use and should be used immediately.
  </Card>
  <Card title="Store Identity Mappings" icon="database">
    Maintain a mapping between your users and their Anchor identity IDs in your database for future session creation.
  </Card>
  <Card title="Use Metadata" icon="tags">
    Store your external user ID in the identity metadata to easily correlate identities with your users.
  </Card>
  <Card title="Handle Errors" icon="triangle-exclamation">
    Implement proper error handling for cases where identity creation fails or the user cancels the flow.
  </Card>
</CardGroup>

## Related Resources

- [Browser Profiles](/essentials/authentication-and-identity) - Alternative approach using browser profiles
- [Sessions API](/api-reference/sessions/create-session) - Full session creation documentation
- [Identities API](/api-reference/identities/update-identity) - Identity management endpoints
```
